{% extends 'data_table/table_list.html' %}

{% block query_table %}
<!-- 内容主体区域 -->
<div class="layui-form-item" lay-filter="test">
  <div class="layui-input-block">
    <label>数据日期</label>
    <div class="layui-inline">
      <input type="text" class="layui-input" id="test1" lay-filter="laydate">
    </div>
    <button class="layui-btn" lay-submit lay-filter="submit">查询</button>
    <button id="reset" class="layui-btn">重置</button>
    <label>排片中心</label>
    <div class="layui-inline layui-form" id="center_se" lay-filter="film_center">
      <select name="center_val" id="center_val">
        <option value="">请选择</option>
        <option value="南排片中心">南排片中心</option>
        <option value="北排片中心">北排片中心</option>
      </select>
    </div>
  </div>
</div>
<div>
    <table id="table1" lay-filter="table"></table>
  </div>
{% endblock query_table %}

{% block script %}
<script src="{{ url_for('static', filename='layui/layui.js') }}"></script>

<script>
//JavaScript代码区域

layui.use(['layer','laydate','form','table'], function(){
  var layer = layui.layer,
  laydate = layui.laydate,
  form = layui.form,
  table = layui.table;

  //重置键
  document.getElementById("reset").onclick=function(){
  document.getElementById("test1").value = "";
  document.getElementById("center_val").value = "";
  form.render();
}

  //导航选择高亮
  document.getElementById("film_center").parentElement.className += " layui-bg-green";
  
  laydate.render({
    elem: '#test1'
  });

  form.render("select");
  
  form.on('submit(submit)',function(){
    var input = document.getElementById("test1");
    var date1 = input.value;
    var select = document.getElementById("center_val");
    var center_val = select.value;
    table.render({
      elem:"#table1",
      height:"full-30",
      limit:30,
      limits:[10,30,50,100],
      url:"/data/api?table=film_center&area_field=film_center&area_value=" + center_val + "&date=" + date1,
      parseData:function(res){
        return {
          "code":res.code,
          "msg":res.msg,
          "data":res.result,
          "count":res.total
        }
      },
      page:true,
      toolbar:true,
      defaultToolbar:["filter","exports"],
      cols:[[
        {field:"film_center",title:"排片中心",width:100,fixed:"left"},
        {field:"film",title:"影片",width:150,fixed:"left"},
        {field:"session",title:"场次",width:100},
        {field:"session_percent",title:"场次占比%",width:120,sort:true},
        {field:"people",title:"人次",width:100},
        {field:"people_percent",title:"人次占比%",width:120,sort:true},
        {field:"seats",title:"总座位数",width:100},
        {field:"seats_percent",title:"排座占比%",width:120,sort:true},
        {field:"bo",title:"票房",width:100},
        {field:"bo_percent",title:"票房占比%",width:120,sort:true},
        {field:"jy_ratio",title:"金逸供需",width:100},
        {field:"arrange_film_effect",title:"排座效率",width:100},
        {field:"arrange_film_benefit",title:"排座效益",width:100},
        {field:"occupancy",title:"上座率%",width:100},
        {field:"people_per_session",title:"场均人次",width:100},
        {field:"op_date",title:"票房日期",width:150}
      ]],

    });
  });
  
});
</script>
{% endblock script %}